---           
layout: post
title: Modeling 2.0 : Let's collaborate!
date: 2012-01-19 15:23:17 UTC
updated: 2012-01-19 15:23:17 UTC
comments: false
categories: CDO Collaboration GMF Modeling Obeo Designer Viewpoint
---
 
<div><div><div class="separator" style="clear: both; text-align: center;"></div><br /><div><span class="Apple-style-span" style="font-family: Georgia,'Times New Roman',serif; font-size: large;"><i>A bit of history</i></span></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-_L5LjwAAt1Q/TnDglI9L_bI/AAAAAAAAAU4/jJnJse63_aQ/s1600/history.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="150" src="http://4.bp.blogspot.com/-_L5LjwAAt1Q/TnDglI9L_bI/AAAAAAAAAU4/jJnJse63_aQ/s200/history.png" width="200" /></a></div><br /><br />4 years ago, when I joined <a href="http://www.obeo.fr/">Obeo</a>, I started to work on a new modeling tool dedicated to system engineering. The main focus of this tool was to enable system engineers to model graphically complex systems with different representations, for each speciality, depending on their viewpoint.&nbsp;The tool was&nbsp;<a href="http://www.csdm2010.csdm.fr/IMG/pdf/CSDM_-_Model-driven_architecture_building_V3_NXPowerLite_.pdf">associated to a&nbsp;methodology</a>&nbsp;and integrated in a modeling workbench.<br /><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-TBt0CQPtC90/TnEiElB3O_I/AAAAAAAAAVE/CFvFUok0MAQ/s1600/scheme.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-TBt0CQPtC90/TnEiElB3O_I/AAAAAAAAAVE/CFvFUok0MAQ/s1600/scheme.png" /></a></div><br /><br /><br />Separation of concerns by representations was a <b>first step</b> to <b>scalability</b> of graphical representations, another was to add several mechanisms (layers, filters, hide/reveal) to allow end users to hide some elements. The approach is somehow similar <a href="http://milesparker.blogspot.com/2011/09/mylyn-modeling-love.html">on what Miles is working on</a>.<br /><br />We took the decision to create a generic runtime with the possibility to specify graphical representations and to&nbsp;<a href="http://model-driven-blogging.blogspot.com/2009/05/viewpoints-enabled-modeling-tools.html">drive the tooling by the viewpoints</a>. The approach has similarities with <a href="http://koehnlein.blogspot.com/2011/07/graphical-syntax-view-for-xtext.html">Jan current's work</a>, and I think our work&nbsp;<a href="http://www.blogger.com/comment.g?blogID=5749374620125186414&amp;postID=1848800102029818548">inspired him a little bit</a>.<br /><br />Since the runtime has been used for <a href="http://modeldrivenblog.blogspot.com/2011/01/mde-in-action-for-safety-analysis.html">safety analysis</a> (<a href="http://2.bp.blogspot.com/-nKRZfr5nhag/TePA2HHc2cI/AAAAAAAAARM/W5f_g7xuv5Q/s1600/fourSlide.PNG">diagram screenshot</a>) and several other use cases.<br /><br />However, although our tool primary concerns was collaborate modeling since its inception, we did not offer directly a solution to the concurrent access problem. In fact, we left it to the Revision Control System (RCS) used by end users. As Alex wrote concurrent access management by RCS have <a href="http://alagarde.tumblr.com/post/8126459718/live-collaboration-with-obeo-designer-6">several drawbacks</a>, so we decided to offer the possibility for end users to <b>collaborate</b> more <b>seamlessly</b>.<br /><br />On the technical side, we decided to use <a href="http://www.eclipse.org/cdo/">CDO</a>, a technology we had&nbsp;experienced&nbsp;successfully&nbsp;in others projects, and which seems to match the most to our requirements. As our graphical modeling technology is based on <a href="http://www.eclipse.org/modeling/gmp/?project=gmf-runtime#gmf-runtime">GMF Runtime</a>, our global technical task was to integrate GMF and CDO.<br /><br /><i><span class="Apple-style-span" style="font-family: Georgia,'Times New Roman',serif; font-size: large;">GMF and CDO, integration challenges</span></i><br /><i><span class="Apple-style-span" style="font-family: Georgia,'Times New Roman',serif; font-size: large;"><br /></span></i><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-OrtpIzhXr-s/TnDgmezU1kI/AAAAAAAAAU8/snZEUXs1P6w/s1600/plugin.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="http://4.bp.blogspot.com/-OrtpIzhXr-s/TnDgmezU1kI/AAAAAAAAAU8/snZEUXs1P6w/s200/plugin.png" width="200" /></a></div>If you are used to component architecture like the Eclipse platform one, you may think that these two components will plug together quite easily. Unfortunately, this is not the case for various reasons :<br /><br /><ul><li>EMF Transactions and CDO Transactions<br />GMF Runtime relies on <a href="http://www.eclipse.org/modeling/emf/?project=transaction">EMF Transaction</a> to manage read and write accesses to models. To simplify this means that one is not allowed to do a modification without encapsulating its change in a recording command. On its side CDO provides its own transaction mechanism, which relies on the database store one. So it is necessary to integrate the two mechanisms. This is one of the features <a href="http://wiki.eclipse.org/Dawn">Dawn</a> provides (see those&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=329777">bugzilla</a> <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=323792">entries</a> for further information).</li></ul><ul><li>Transactional model break in GMF Runtime <br />GMF Runtime is a bridge between EMF models and <a href="http://www.eclipse.org/gef/">GEF</a>. Among others things, it provides a notation model, to store graphical information. The synchronization between the graphical model and the semantic model, is one of the responsibility of edit parts. The choice to split the synchronization responsibility in each edit part enables one to easily override the default behavior for a given edit part. This choice is consistent with the <a href="http://help.eclipse.org/galileo/topic/org.eclipse.gmf.doc/prog-guide/runtime/Developer%20Guide%20to%20Diagram%20Runtime.html#_Toc119420270">high extensible approach</a> of the framework. However, it has one major drawback, edit parts should be instantiated to update the notation model ! As GMF Runtime edit parts creation is done in an <a href="http://help.eclipse.org/galileo/index.jsp?topic=/org.eclipse.emf.transaction.doc/references/overview/listeners.html">post commit listener</a>, when no models changes are allowed, the runtime have to force the transaction using a <a href="http://help.eclipse.org/galileo/topic/org.eclipse.emf.transaction.doc/references/javadoc/org/eclipse/emf/transaction/Transaction.html#OPTION_UNPROTECTED">special option</a>.<br />This behavior prevents one to have triggers for those modifications. If you need to avoid conflicts (see below), you will not be able to acquire lock before commit. In this case it means that one have to extract the&nbsp;synchronization from edit parts and to call it at the right time.</li><li>Avoiding conflicts<br />If CDO provides live updates of shared models, it does not prevents conflicts. There is two ways to handle them. The first one is to write your own <a href="http://help.eclipse.org/indigo/index.jsp?topic=%2Forg.eclipse.emf.cdo.doc%2Fjavadoc%2Forg%2Feclipse%2Femf%2Fcdo%2Ftransaction%2Fclass-use%2FCDOConflictResolver.html">conflict resolver</a>, which will take a decision when a conflict occurs. The second one is to avoid conflicts through locks. Easier to said than to implement, but that the way we choose.</li><ul><li>Lock integration<br />To avoid conflicts, the simplest way is to lock automatically elements before their edition. In practice, one could use the EMF Transaction trigger mechanism to do this. Edit parts need to listen to locks events to deactivate accordingly their edition capabilities and provide visual indicators of the lock. Lastly, to provide <a href="http://wiki.eclipse.org/FAQ_for_CDO_and_Net4j#How_about_locking.2C_one_client_can_lock_the_object_so_that_the_other_clients_not_allow_to_change_till_it.27s_unlocked.3F_Is_there_any_tree-locking_facilities_in_CDO_and.2For_EMF.3F">logical lock for end-users</a>,&nbsp;one may provide a lock strategy.</li><li>Consistency maintenance on client side<br />EMF Transaction enables one to rollback a transaction, before its commit. This is generally done for validation or lock acquisitions purposes. The recording command manages this rollback and will abort properly the transaction if it occurs. However with the abort, the CDO state of the object will change (see <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=312534">bug 312534</a> for more details). To avoid conflicts a solution is to use CDO <a href="http://wiki.eclipse.org/New_And_Noteworthy_for_CDO_2.0#Create_save_point">save points</a>&nbsp;to restore the object to a clean state if a transaction aborts.<br />&nbsp;</li></ul><li>Native mode for GMF Runtime notation models ?<br />One of the coolest thing of CDO is its <a href="http://thegordian.blogspot.com/2008/11/how-scalable-are-my-models.html">EObject implementation</a>, but to benefit from the scalability it provides, you need to regenerate your metamodel with a CDO dependency. When one works with such CDO model instances, the mode in which one is, is called&nbsp;<i>native</i>. As GMF Runtime notation metamodel depends on the EMF one (<a href="http://www.eclipsezone.com/eclipse/forums/t58965.html#91972189">don't do this at home</a>), using notation models in native mode is far from being easy. So we worked on a solution which keeps source and binary compatibility with legacy code (see <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=336707">bug 336707</a> for technical details) and provides notation cdo native models, the code is <a href="http://code.google.com/a/eclipselabs.org/p/cdo-gmf-notation/">available here</a> (no builds yet).<br />&nbsp; &nbsp;</li><li>Content and cross reference adapters<br />These two <i>utilities</i> should not be used as they will break the lazy loading mechanism of CDO. By default GMF runtime initializes one cross reference adapter when configuring the editing domain. You could quite easily&nbsp;override&nbsp;the default behavior. EMF Transaction uses an adapter that <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=323792#c5">walk through its content</a>, but removing it is much harder.&nbsp;</li></ul><div>On our product, the work is still in progress, but we he have implemented solutions for most challenges presented above. During this work we opened several issues : &nbsp;&nbsp;</div><div><ul><li>fixed :&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=345719">bug 345719</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=352191">bug 352191</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=355915">bug 355915</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=337870">bug 337870</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=353167">bug 353167</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=329753">bug 329753</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=315570">bug 315570</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=329869">bug 329869</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=329752">bug 329752</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=353076">bug 353076</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=351393">bug 351393</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=351921">bug 351921</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=325436">bug 325436</a>, <a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=346378">bug 346378</a></li><li>not yet fixed :&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=339908">bug 339908</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=352189">bug 352189</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=352189">bug 352977</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=352204">bug 352204</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=357400">bug 357400</a>,&nbsp;<a href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=329786">bug 329786</a></li></ul></div><div>As you may seen, the CDO team has been very responsive, and already provided fixes for most of them. I would like to thank them for their availability and help.<br /><br /><i>This blog entry present results coming from a work collaboration between Thales and Obeo.<br />Ce message de blog est issu d'un travail en commun entre Thales et       Obeo.</i> </div></div></div>